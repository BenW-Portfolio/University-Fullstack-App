{% extends "layout.html" %} 

{% block head_content %} 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/Styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block body %}
<div class="container mt-4"> 
    <h2>Available Courses</h2>
    <p>Select a section below to register.</p>


    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}


    {% if courses %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Course Code</th>
                        <th>Title</th>
                        <th>Credits</th>
                        <th>Term</th>
                        <th>Day</th>
                        <th>Time</th>
                        <th>Location</th>
                        <th>Seats Available</th> 
                        <th>Instructor</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in courses %}
                    <tr>
                        <td>{{ course.dept_code }} {{ course.course_number }}</td>
                        <td>{{ course.title }}</td>
                        <td>{{ course.credits }}</td>
                        <td>{{ course.semester }} {{ course.year }}</td>
                        <td>{{ course.day }}</td>
                        <td>{{ course.time_slot }}</td>
                        <td>{{ course.room_location | default('TBA') }}</td> 
                        <td>
                            {% if course.seats_available == 0 %}
                                <span style="color: red; font-weight: bold;">Full ({{ course.room_capacity }})</span>
                            {% elif course.seats_available == 'N/A' %}
                                <span style="color: grey;">N/A</span>
                            {% else %}
                                {{ course.seats_available }} / {{ course.room_capacity }}
                            {% endif %}
                        </td> 
                        <td>{{ course.instructor_fname | default('Staff') }} {{ course.instructor_lname | default('') }}</td>
                        <td>
                            {% if course.seats_available == 0 or course.seats_available == 'N/A' %}
                                <button class="btn btn-secondary btn-sm" disabled>Full/Closed</button> 
                            {% else %}
                                <form action="{{ url_for('register_class') }}" method="post" style="display:inline;">
                                    <input type="hidden" name="section_id" value="{{ course.section_id }}">
                                    <button type="submit" class="btn btn-primary btn-sm">Register</button> 
                                </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %} 
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-muted">No courses available for registration at this time.</p> 
    {% endif %} 

</div> 


{% endblock %}