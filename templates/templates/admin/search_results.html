<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - Graduate Admissions System</title>
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</head>
<body class="bg-light">
    <div class="container-fluid mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-primary">
                <i class="bi bi-search"></i> Search Results
                {% if search_term %}
                for "{{ search_term }}"
                {% endif %}
            </h2>
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Dashboard
            </a>
        </div>

        <!-- Enhanced Search Card -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-funnel"></i> Refine Search</h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('admin.search_applicants') }}" method="GET">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Search Term</label>
                            <div class="input-group">
                                <input type="text" 
                                       class="form-control" 
                                       name="q" 
                                       placeholder="Name, Student ID, or keywords..." 
                                       value="{{ search_term }}">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Search By</label>
                            <select class="form-select" name="by">
                                <option value="all" {% if search_by == 'all' %}selected{% endif %}>All Fields</option>
                                <option value="name" {% if search_by == 'name' %}selected{% endif %}>Name</option>
                                <option value="id" {% if search_by == 'id' %}selected{% endif %}>Student ID</option>
                                <option value="degree" {% if search_by == 'degree' %}selected{% endif %}>Degree Program</option>
                                <option value="semester" {% if search_by == 'semester' %}selected{% endif %}>Admission Term</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="">All Statuses</option>
                                <option value="incomplete" {% if request.args.get('status') == 'incomplete' %}selected{% endif %}>Incomplete</option>
                                <option value="review" {% if request.args.get('status') == 'review' %}selected{% endif %}>Under Review</option>
                                <option value="admitted" {% if request.args.get('status') == 'admitted' %}selected{% endif %}>Admitted</option>
                                <option value="rejected" {% if request.args.get('status') == 'rejected' %}selected{% endif %}>Rejected</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Section -->
        {% if results %}
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list-ul"></i> 
                    Found {{ results|length }} Application{{ 's' if results|length != 1 }}
                </h5>
                <div>
                    <span class="badge bg-light text-dark me-2">
                        MS: {{ results|selectattr('degree_program','equalto','MS')|list|length }}
                    </span>
                    <span class="badge bg-light text-dark">
                        PhD: {{ results|selectattr('degree_program','equalto','PhD')|list|length }}
                    </span>
                </div>
            </div>
            
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Student ID</th>
                                <th>Applicant</th>
                                <th>Program</th>
                                <th>Admission Term</th>
                                <th>Status</th>
                                <th>Reviews</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for app in results %}
                            <tr>
                                <td class="font-monospace">{{ app.user_id }}</td>
                                <td>
                                    <strong>{{ app.last_name }}, {{ app.first_name }}</strong>
                                    <div class="text-muted small">{{ app.email }}</div>
                                </td>
                                <td>
                                    <span class="badge 
                                        {% if app.degree_program == 'PhD' %}bg-primary
                                        {% else %}bg-secondary{% endif %}">
                                        {{ app.degree_program }}
                                    </span>
                                </td>
                                <td>
                                    {{ app.admission_semester }} {{ app.admission_year }}
                                </td>
                                <td>
                                    <span class="badge rounded-pill 
                                        {% if app.status == 'Admitted' %}bg-success
                                        {% elif app.status == 'Rejected' %}bg-danger
                                        {% elif app.status == 'Application Submitted & Under Review' %}bg-info
                                        {% else %}bg-warning text-dark{% endif %}">
                                        {{ app.status }}
                                    </span>
                                    {% if app.transcript_received and app.recommendation_received %}
                                    <span class="badge bg-success">Complete</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if app.review_count > 0 %}
                                    <span class="badge bg-info">
                                        {{ app.review_count }} review{% if app.review_count > 1 %}s{% endif %}
                                    </span>
                                    {% else %}
                                    <span class="badge bg-secondary">Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('admin.application_detail', application_id=app.application_id) }}" 
                                           class="btn btn-primary"
                                           title="View details">
                                            <i class="bi bi-eye-fill"></i>
                                        </a>
                                        {% if app.status == 'Application Submitted & Under Review' %}
                                        <a href="{{ url_for('admin.submit_review', application_id=app.application_id) }}" 
                                           class="btn btn-warning"
                                           title="Submit review">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            {% if results|length > 10 %}
            <div class="card-footer bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">Showing {{ results|length }} of {{ total_results }} applications</small>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary">Previous</button>
                        <button class="btn btn-sm btn-outline-primary">Next</button>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% else %}
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <i class="bi bi-exclamation-circle fs-1 text-muted"></i>
                <h4 class="mt-3 text-muted">No applications found</h4>
                <p class="text-muted">
                    {% if search_term %}
                    No results match your search criteria
                    {% else %}
                    No applications available for viewing
                    {% endif %}
                </p>
                <a href="{{ url_for('admin.dashboard') }}" class="btn btn-primary mt-3">
                    <i class="bi bi-house-door"></i> Return to Dashboard
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Enable tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
    </script>
</body>
</html>